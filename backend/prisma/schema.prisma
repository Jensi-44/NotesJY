// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
   output   = "../node_modules/.prisma/client"

}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}


model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  username  String   @unique
  email     String   @unique
  password  String
  createdAt DateTime @default(now())

  // User owns many notes
  notes     Note[]   @relation("UserNotes")

  // NEW: Notes shared with this user
  sharedNotes NoteShare[] @relation("UserNoteShares")

  @@map("users")
}


model Note {
 id        String   @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  content    String?
  category   String?  @default("Other")
  isPinned   Boolean  @default(false)
  isArchived Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  userId     String   @db.ObjectId
  user       User     @relation("UserNotes", fields: [userId], references: [id], onDelete: Cascade)


  sharedWith NoteShare[] @relation("NoteShares")

  @@map("notes")
}

model NoteShare {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  noteId     String   @db.ObjectId
  userId     String   @db.ObjectId
  permission String   // "view" or "edit"
  createdAt  DateTime @default(now())

  note       Note     @relation("NoteShares", fields: [noteId], references: [id], onDelete: Cascade)
  user       User     @relation("UserNoteShares", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([noteId, userId])
  @@map("note_shares")
}
model Invitation {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  email      String
  noteId     String   @db.ObjectId
  accepted   Boolean  @default(false)    
  userId     String?  @db.ObjectId      
  acceptedAt DateTime?                   
  createdAt  DateTime @default(now())

  @@map("invitations")
}
